var CustomExtensions;!function(t){var e=function(){function t(t,e){void 0===e&&(e={});var s=this;this._dashboardControl=t,this.options=e,this.name="custom-dashboard-panel",this._iconBack="dx-dashboard-back",this._dashboardsButtonName="Dashboards",this._flexParent="dx-dashboard-flex-parent",this._dashboardsButton="dx-dashboards-button",this._dashboardTruncated="dx-dashboard-truncated",this._ellipsisText="dx-dashboard-ellipsis",this._itemTemplate=ko.observable(),this._isMobile=ko.observable(!1),this._disposables=[],this.panelWidth=250,this.visible=ko.observable(!1),this.allowSwitchToDesigner=ko.observable(!0),this.selectedItemKeys=ko.observableArray(),this.availableDashboards=ko.observableArray(),this._actualPanelWidth=ko.observable(),this._left=ko.computed(function(){return s.visible()?0:-s._actualPanelWidth()}),this.showPanelAsync=function(t){var e=$.Deferred();return s.visible(!0),s.updateDashboardsList(),setTimeout(function(){t.surfaceLeft=s.panelWidth,e.resolve(t)},500),e.promise()},this.hidePanelAsync=function(t){var e=$.Deferred();return s.visible(!1),setTimeout(function(){t.surfaceLeft=0,e.resolve(t)},500),e.promise()},this.switchToViewer=function(){s._dashboardControl.switchToViewer()},this.switchToDesigner=function(){s._dashboardControl.switchToDesigner()},this._toolbarElement=new DevExpress.Dashboard.DashboardToolbarGroup("viewer-button","",100);var o=new DevExpress.Dashboard.DashboardToolbarItem("toviewer",function(){return s.switchToViewer()});o.template="dashboard-custom-panel-extension-viewer-button",o.disabled=ko.pureComputed(function(){return!!s._dashboardControl.dashboard()}),this._toolbarElement.items.push(o),this.designerToViewerAction={orderNo:60,action:this.showPanelAsync},this.viewerToDesignerAction={orderNo:20,action:this.hidePanelAsync}}return t.prototype.start=function(){var t=this,e=this._dashboardControl.findExtension("mobile-layout");this._isMobile(e&&e.mobileLayoutEnabled()),e.mobileLayoutEnabled.subscribe(function(){t.stop(),t.start()}),this._isMobile()?this.allowSwitchToDesigner(!1):void 0===this.allowSwitchToDesigner()&&this.allowSwitchToDesigner(this._dashboardControl.allowSwitchToDesigner),this.visible(!this._isMobile()&&!this._dashboardControl.isDesignMode()),this._itemTemplate(this._getTemplateName()),this._isMobile()?(this._actualPanelWidth($(window).width()),DevExpress.devices.on("orientationChanged",function(e){t._actualPanelWidth($(window).width())})):this._actualPanelWidth(this.panelWidth),this._customTemplate=this._getCustomTemplate(),this._dashboardControl.customTemplates.push(this._customTemplate);var s=this._dashboardControl.findExtension("toolbox");if(s&&s.toolbarGroups.push(this._toolbarElement),this._disposables.push(this._dashboardControl.dashboardContainer.subscribe(function(e){e&&t._validateSelection(e,t.availableDashboards())})),this._isMobile()){var o=this._dashboardControl.findExtension("viewer-api"),i=o._options.onDashboardTitleToolbarUpdated;o._options.onDashboardTitleToolbarUpdated=function(e){e.options.navigationItems.push({type:"button",template:function(){return $("<div/>").addClass([t._flexParent,t._ellipsisText].join(" ")).append($('<svg><use xlink:href="#'+t._iconBack+'" /></svg>')).append($("<div/>").text(t._dashboardsButtonName).addClass([t._dashboardsButton,t._dashboardTruncated].join(" ")))},click:function(){t.showPanelAsync({surfaceLeft:t._actualPanelWidth()})}}),i.call(t,e)}}this._dashboardControl.isDesignMode()||this._dashboardControl.surfaceLeft(this._isMobile()?0:this.panelWidth),this.updateDashboardsList()},t.prototype.stop=function(){this._disposables.forEach(function(t){return t.dispose()}),this._disposables=[];var t=this._dashboardControl.findExtension("toolbox");t&&t.toolbarGroups.remove(this._toolbarElement),this._dashboardControl.customTemplates.remove(this._customTemplate)},t.prototype.updateDashboardsList=function(){var t=this,e=(this._dashboardControl.dashboardContainer(),this.options);this._dashboardControl.requestDashboardList().done(function(o){t.availableDashboards(o.map(function(t){return new s(t.id,t.name,e.dashboardThumbnail?DevExpress.utils.string.format(e.dashboardThumbnail,t.id):void 0)})),t._validateSelection(t._dashboardControl.dashboardContainer(),t.availableDashboards())})},t.prototype._validateSelection=function(t,e){if(t){var s=e.filter(function(e){return e.id===t.id})[0];s&&this.selectedItemKeys([s.id])}},t.prototype._getTemplateName=function(){return this._isMobile()?this.options.dashboardThumbnail?"dashboard-preview":"dashboard-card-view":"dashboard-list-item"},t.prototype._hidePanel=function(){this._isMobile()&&this.hidePanelAsync({surfaceLeft:0})},t.prototype._getCustomTemplate=function(){var t=this,e={noDataText:"",keyExpr:"id",selectionMode:"single",itemTemplate:this._itemTemplate,activeStateEnabled:!1,selectedItemKeys:this.selectedItemKeys,onItemClick:function(){t._hidePanel()},searchEnabled:this._isMobile,searchExpr:"id",hoverStateEnabled:!this._isMobile,focusStateEnabled:!this._isMobile,searchEditorOptions:{placeholder:DevExpress.Designer.getLocalization("DashboardWebStringId.Search")},onOptionChanged:function(e){if("selectedItemKeys"===e.name&&t.selectedItemKeys().length>0){var s=t.availableDashboards().filter(function(e){return e.id===t.selectedItemKeys()[0]})[0];e.component.scrollToItem(t.availableDashboards().indexOf(s))}},onSelectionChanged:function(e){var s=e.addedItems[0].id;t._dashboardControl.dashboardContainer()&&t._dashboardControl.dashboardContainer().id===s||t._dashboardControl.loadDashboard(s)}};return $.extend(e,this._isMobile()?{dataSource:this.availableDashboards}:{items:this.availableDashboards}),{name:"dashboard-custom-panel-extension",data:{panelWidth:this._actualPanelWidth,allowSwitchToDesigner:this.allowSwitchToDesigner,left:this._left,isMobile:this._isMobile,hidePanel:function(){t._hidePanel()},switchToDesigner:this.switchToDesigner,switchToViewer:this.switchToViewer,listOptions:e}}},t}();t.CustomDashboardPanelExtension=e;var s=function(){function t(t,e,s){this.id=t,this.name=e,this.imageUrl=s,this.hidden=ko.observable(!1)}return t.prototype.hide=function(){this.hidden(!0)},t}()}(CustomExtensions||(CustomExtensions={}));