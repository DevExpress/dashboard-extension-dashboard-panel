var CustomExtensions;!function(t){var e=function(){function t(t,e){void 0===e&&(e={});var o=this;this._dashboardControl=t,this.options=e,this.name="custom-dashboard-panel",this._iconBack="dx-dashboard-back",this._dashboardsButtonName="Dashboards",this._flexParent="dx-dashboard-flex-parent",this._dashboardsButton="dx-dashboards-button",this._dashboardTruncated="dx-dashboard-truncated",this._ellipsisText="dx-dashboard-ellipsis",this._itemTemplate=ko.observable(),this._isMobile=ko.observable(!1),this._disposables=[],this.panelWidth=250,this.visible=ko.observable(!1),this.allowSwitchToDesigner=ko.observable(!0),this.selectedItemKeys=ko.observableArray(),this.availableDashboards=ko.observableArray(),this._actualPanelWidth=ko.observable(this.panelWidth),this._left=ko.computed(function(){return o.visible()?0:-o._actualPanelWidth()}),this.showPanelAsync=function(t){var e=$.Deferred();return o.visible(!0),o.updateDashboardsList(),setTimeout(function(){t.surfaceLeft=o.panelWidth,e.resolve(t)},500),e.promise()},this.hidePanelAsync=function(t){var e=$.Deferred();return o.visible(!1),setTimeout(function(){t.surfaceLeft=0,e.resolve(t)},500),e.promise()},this.switchToViewer=function(){o._dashboardControl.switchToViewer()},this.switchToDesigner=function(){o._dashboardControl.switchToDesigner()},this._toolbarElement=new DevExpress.Dashboard.DashboardToolbarGroup("viewer-button","",100);var s=new DevExpress.Dashboard.DashboardToolbarItem("toviewer",function(){return o.switchToViewer()});s.template="dashboard-custom-panel-extension-viewer-button",s.disabled=ko.pureComputed(function(){return!!o._dashboardControl.dashboard()}),this._toolbarElement.items.push(s),this.designerToViewerAction={orderNo:60,action:this.showPanelAsync},this.viewerToDesignerAction={orderNo:20,action:this.hidePanelAsync}}return t.prototype.start=function(){var t=this,e=this._dashboardControl.findExtension("mobile-layout");this._isMobile(e&&e.mobileLayoutEnabled()),e.mobileLayoutEnabled.subscribe(function(){t.stop(),t.start()}),this._isMobile()?this.allowSwitchToDesigner(!1):void 0===this.allowSwitchToDesigner()&&this.allowSwitchToDesigner(this._dashboardControl.allowSwitchToDesigner),this.visible(!this._isMobile()&&!this._dashboardControl.isDesignMode()),this._itemTemplate(this._getTemplateName()),this._isMobile()&&(this._actualPanelWidth($(window).width()),DevExpress.devices.on("orientationChanged",function(e){t._actualPanelWidth($(window).width())})),this._customTemplate=this._getCustomTemplate(),this._dashboardControl.customTemplates.push(this._customTemplate);var o=this._dashboardControl.findExtension("toolbox");if(o&&o.toolbarGroups.push(this._toolbarElement),this._disposables.push(this._dashboardControl.dashboardContainer.subscribe(function(e){e&&t._validateSelection(e,t.availableDashboards())})),this._isMobile()){var s=this._dashboardControl.findExtension("viewer-api"),i=s._options.onDashboardTitleToolbarUpdated;s._options.onDashboardTitleToolbarUpdated=function(e){e.options.navigationItems.push({type:"button",template:function(){return $("<div/>").addClass([t._flexParent,t._ellipsisText].join(" ")).append($('<svg><use xlink:href="#'+t._iconBack+'" /></svg>')).append($("<div/>").text(t._dashboardsButtonName).addClass([t._dashboardsButton,t._dashboardTruncated].join(" ")))},click:function(){t.showPanelAsync({surfaceLeft:t._actualPanelWidth()})}}),i.call(t,e)}}this._dashboardControl.isDesignMode()||this._dashboardControl.surfaceLeft(this._isMobile()?0:this.panelWidth),this.updateDashboardsList()},t.prototype.stop=function(){this._disposables.forEach(function(t){return t.dispose()}),this._disposables=[];var t=this._dashboardControl.findExtension("toolbox");t&&t.toolbarGroups.remove(this._toolbarElement),this._dashboardControl.customTemplates.remove(this._customTemplate)},t.prototype.updateDashboardsList=function(){var t=this,e=(this._dashboardControl.dashboardContainer(),this.options);this._dashboardControl.requestDashboardList().done(function(s){t.availableDashboards(s.map(function(t){return new o(t.id,t.name,e.dashboardThumbnail?DevExpress.utils.string.format(e.dashboardThumbnail,t.id):void 0)})),t._validateSelection(t._dashboardControl.dashboardContainer(),t.availableDashboards())})},t.prototype._validateSelection=function(t,e){if(t){var o=e.filter(function(e){return e.id===t.id})[0];o&&this.selectedItemKeys([o.id])}},t.prototype._getTemplateName=function(){return this._isMobile()?this.options.dashboardThumbnail?"dashboard-preview":"dashboard-card-view":"dashboard-list-item"},t.prototype._hidePanel=function(){this._isMobile()&&this.hidePanelAsync({surfaceLeft:0})},t.prototype._getCustomTemplate=function(){var t=this;return{name:"dashboard-custom-panel-extension",data:{panelWidth:this._actualPanelWidth,allowSwitchToDesigner:this.allowSwitchToDesigner,left:this._left,selectedItemKeys:this.selectedItemKeys,availableDashboards:this.availableDashboards,itemTemplate:this._itemTemplate,isMobile:this._isMobile,hidePanel:function(){t._hidePanel()},switchToDesigner:this.switchToDesigner,switchToViewer:this.switchToViewer,onOptionChanged:function(e){if("selectedItemKeys"===e.name&&t.selectedItemKeys().length>0){var o=t.availableDashboards().filter(function(e){return e.id===t.selectedItemKeys()[0]})[0];e.component.scrollToItem(t.availableDashboards().indexOf(o))}},onSelectionChanged:function(e){var o=e.addedItems[0].id;t._dashboardControl.dashboardContainer()&&t._dashboardControl.dashboardContainer().id===o||t._dashboardControl.loadDashboard(o)}}}},t}();t.CustomDashboardPanelExtension=e;var o=function(){function t(t,e,o){this.id=t,this.name=e,this.imageUrl=o,this.hidden=ko.observable(!1)}return t.prototype.hide=function(){this.hidden(!0)},t}()}(CustomExtensions||(CustomExtensions={}));